-- Roblox Key System Script
-- Simple and functional key system with auto-save

local KeySystemUI = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local KeyBox = Instance.new("TextBox")
local SubmitButton = Instance.new("TextButton")
local GetKeyButton = Instance.new("TextButton")
local StatusLabel = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")

-- Configuration
local CORRECT_KEY_URL = "https://pastebin.com/raw/CD4DyVWc"
local GET_KEY_LINK = "https://lootdest.org/s?sHCzKHU5"
local SCRIPT_URL = "https://raw.githubusercontent.com/gumanba/Scripts/main/EscapePoliceForBrainrots"
local SAVE_KEY_NAME = "SavedKeySystem_v1.txt"

-- Services
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Functions
local function getSavedKey()
    if readfile then
        local success, result = pcall(function()
            return readfile(SAVE_KEY_NAME)
        end)
        if success and result then
            return result
        end
    end
    return nil
end

local function saveKey(key)
    if writefile then
        pcall(function()
            writefile(SAVE_KEY_NAME, key)
        end)
    end
end

local function fetchCorrectKey()
    local success, result = pcall(function()
        return game:HttpGet(CORRECT_KEY_URL)
    end)
    if success then
        return result:gsub("%s+", "")
    end
    return nil
end

local function loadMainScript()
    local success, err = pcall(function()
        loadstring(game:HttpGet(SCRIPT_URL))()
    end)
    if success then
        StatusLabel.Text = "âœ“ Script Loaded Successfully!"
        StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        wait(1)
        KeySystemUI:Destroy()
    else
        StatusLabel.Text = "âœ— Failed to load script"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    end
end

local function verifyKey(inputKey)
    StatusLabel.Text = "Verifying key..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)

    local correctKey = fetchCorrectKey()

    if not correctKey then
        StatusLabel.Text = "âœ— Cannot verify key (connection error)"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        return false
    end

    local cleanInput = inputKey:gsub("%s+", "")

    if cleanInput == correctKey then
        StatusLabel.Text = "âœ“ Key Correct! Loading script..."
        StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        saveKey(cleanInput)
        wait(0.5)
        loadMainScript()
        return true
    else
        StatusLabel.Text = "âœ— Invalid Key!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        return false
    end
end

local function checkSavedKey()
    local savedKey = getSavedKey()
    if savedKey then
        StatusLabel.Text = "Checking saved key..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)

        local correctKey = fetchCorrectKey()
        if correctKey and savedKey == correctKey then
            StatusLabel.Text = "âœ“ Valid key found! Loading..."
            StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
            wait(0.5)
            loadMainScript()
            return true
        else
            StatusLabel.Text = "Saved key expired. Enter new key."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
        end
    end
    return false
end

-- UI Setup
KeySystemUI.Name = "KeySystemUI"
KeySystemUI.Parent = game.CoreGui
KeySystemUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

MainFrame.Name = "MainFrame"
MainFrame.Parent = KeySystemUI
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -125)
MainFrame.Size = UDim2.new(0, 350, 0, 250)

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(70, 70, 90)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

Title.Name = "Title"
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 10)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Font = Enum.Font.GothamBold
Title.Text = "ðŸ”‘ Key System"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 24

KeyBox.Name = "KeyBox"
KeyBox.Parent = MainFrame
KeyBox.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
KeyBox.BorderSizePixel = 0
KeyBox.Position = UDim2.new(0.1, 0, 0.28, 0)
KeyBox.Size = UDim2.new(0.8, 0, 0, 35)
KeyBox.Font = Enum.Font.Gotham
KeyBox.PlaceholderText = "Enter Key Here..."
KeyBox.Text = ""
KeyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyBox.TextSize = 14
KeyBox.ClearTextOnFocus = false

local KeyBoxCorner = Instance.new("UICorner")
KeyBoxCorner.CornerRadius = UDim.new(0, 6)
KeyBoxCorner.Parent = KeyBox

SubmitButton.Name = "SubmitButton"
SubmitButton.Parent = MainFrame
SubmitButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
SubmitButton.BorderSizePixel = 0
SubmitButton.Position = UDim2.new(0.1, 0, 0.52, 0)
SubmitButton.Size = UDim2.new(0.8, 0, 0, 35)
SubmitButton.Font = Enum.Font.GothamBold
SubmitButton.Text = "Submit Key"
SubmitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitButton.TextSize = 16

local SubmitCorner = Instance.new("UICorner")
SubmitCorner.CornerRadius = UDim.new(0, 6)
SubmitCorner.Parent = SubmitButton

GetKeyButton.Name = "GetKeyButton"
GetKeyButton.Parent = MainFrame
GetKeyButton.BackgroundColor3 = Color3.fromRGB(70, 200, 100)
GetKeyButton.BorderSizePixel = 0
GetKeyButton.Position = UDim2.new(0.1, 0, 0.72, 0)
GetKeyButton.Size = UDim2.new(0.8, 0, 0, 35)
GetKeyButton.Font = Enum.Font.GothamBold
GetKeyButton.Text = "Get Key"
GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GetKeyButton.TextSize = 16

local GetKeyCorner = Instance.new("UICorner")
GetKeyCorner.CornerRadius = UDim.new(0, 6)
GetKeyCorner.Parent = GetKeyButton

StatusLabel.Name = "StatusLabel"
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0.9, 0)
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Enter your key to continue"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 12

CloseButton.Name = "CloseButton"
CloseButton.Parent = MainFrame
CloseButton.BackgroundTransparency = 1
CloseButton.Position = UDim2.new(0.9, 0, 0, 5)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "Ã—"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 24

-- Make draggable
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Button hover effects
local function addHoverEffect(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)

    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor}):Play()
    end)
end

addHoverEffect(SubmitButton, Color3.fromRGB(0, 170, 255), Color3.fromRGB(0, 200, 255))
addHoverEffect(GetKeyButton, Color3.fromRGB(70, 200, 100), Color3.fromRGB(90, 220, 120))

-- Button functionality
SubmitButton.MouseButton1Click:Connect(function()
    local inputKey = KeyBox.Text
    if inputKey == "" then
        StatusLabel.Text = "âœ— Please enter a key"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        return
    end
    verifyKey(inputKey)
end)

GetKeyButton.MouseButton1Click:Connect(function()
    setclipboard(GET_KEY_LINK)
    StatusLabel.Text = "âœ“ Link copied! Opening in browser..."
    StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)

    pcall(function()
        game:GetService("GuiService"):OpenBrowserWindow(GET_KEY_LINK)
    end)
end)

CloseButton.MouseButton1Click:Connect(function()
    KeySystemUI:Destroy()
end)

-- Check for saved key on load
spawn(function()
    wait(0.5)
    checkSavedKey()
end)